{% extends 'produtividade/base.html' %}
{% block title %}Lan√ßar Produtividade{% endblock %}
{% block content %}
  <h1>Lan√ßar Produtividade ‚Ä¢ {{ grupo.nome }}</h1>

  <form method="get" class="filters">
  <div class="input-group">
    <label class="input-label">Data</label>
    <input type="date" name="data" value="{{ data }}" class="input-field">
  </div>

  <div class="input-group">
    <label class="input-label">Projeto</label>
    <select name="projeto" class="input-field">
      {% for proj in projetos %}
        <option value="{{ proj.id }}"{% if projeto_sel and proj.id == projeto_sel.id %} selected{% endif %}>
  {{ proj.titulo }}
</option>

      {% endfor %}
    </select>
  </div>

  <button class="btn carregar">Carregar</button>
  <button type="button" class="btn accent push-right" id="openCriteria">Guia de crit√©rios</button>
</form>

<!-- Modal Guia de Crit√©rios -->
<div id="criteriaModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="criteriaTitle">
  <div class="modal-dialog">
    <button class="modal-close" id="closeCriteria" aria-label="Fechar">&times;</button>
    <h2 id="criteriaTitle">Guia de crit√©rios ‚Äî UC Projetos</h2>

    <section class="criteria-block">
      <h3>Pontualidade ‚Üí Autogest√£o / Gest√£o do Tempo</h3>
      <ul>
        <li><strong>Autogest√£o (Pontualidade &amp; Assiduidade)</strong></li>
        <li><strong>Gest√£o do Tempo</strong></li>
        <li><strong>Cumprimento de Prazos</strong></li>
      </ul>
      <p><em>Justifica:</em> a UC explicita ‚ÄúDemonstrar autogest√£o‚Äù nas capacidades socioemocionais.</p>
    </section>

    <section class="criteria-block">
      <h3>Comunica√ß√£o ‚Üí Comunica√ß√£o &amp; Trabalho em Equipe</h3>
      <ul>
        <li><strong>Comunica√ß√£o &amp; Trabalho em Equipe</strong></li>
        <li><strong>Colabora√ß√£o &amp; Intelig√™ncia Emocional</strong></li>
        <li><strong>Intera√ß√£o Profissional</strong></li>
      </ul>
      <p><em>Justifica:</em> ‚ÄúIntelig√™ncia emocional‚Äù e ‚ÄúTrabalhar em equipe‚Äù s√£o capacidades socioemocionais previstas na UC.</p>
    </section>

    <section class="criteria-block">
      <h3>Qualidade do C√≥digo ‚Üí Qualidade de Software</h3>
      <ul>
        <li><strong>Qualidade de Software</strong></li>
        <li><strong>Boas Pr√°ticas &amp; Qualidade</strong></li>
        <li><strong>Manutenibilidade &amp; Padr√µes</strong></li>
      </ul>
      <p><em>Justifica:</em> a UC traz ‚ÄúQualidade de software‚Äù em conhecimentos e enfatiza melhores pr√°ticas considerando performance e qualidade.</p>
    </section>

    <section class="criteria-block">
      <h3>Entrega de Tarefas ‚Üí Gest√£o de Cronograma &amp; Entregas</h3>
      <ul>
        <li><strong>Gest√£o de Cronograma &amp; Entregas</strong></li>
        <li><strong>Planejamento &amp; Cumprimento de Etapas</strong></li>
        <li><strong>Sequenciamento &amp; Cronograma</strong></li>
      </ul>
      <p><em>Justifica:</em> capacidades t√©cnicas da UC incluem definir a sequ√™ncia das atividades e elaborar cronograma integrado √†s etapas.</p>
    </section>

    <section class="criteria-block">
      <h3>Resolu√ß√£o de Problemas ‚Üí Pensamento Anal√≠tico &amp; Resolu√ß√£o</h3>
      <ul>
        <li><strong>Pensamento Anal√≠tico &amp; Resolu√ß√£o de Problemas</strong></li>
        <li><strong>Pesquisa de Solu√ß√µes &amp; Melhores Pr√°ticas</strong></li>
        <li><strong>Diagn√≥stico &amp; Corre√ß√£o</strong></li>
      </ul>
      <p><em>Justifica:</em> a UC prev√™ ‚Äúpensamento anal√≠tico‚Äù (socioemocional) e a capacidade t√©cnica de pesquisar melhores pr√°ticas visando performance/qualidade.</p>
    </section>
  </div>
</div>


  <form method="post">
  {% csrf_token %}
  {{ formset.management_form }}  <!-- üëà OBRIGAT√ìRIO PARA FORMSETS -->

  <table class="table">
    <thead >
      <tr>
        <th style="text-align: center;">Aluno</th>
        <th style="text-align: center;">Pontualidade</th>
        <th style="text-align: center;">Comunica√ß√£o</th>
        <th style="text-align: center;">Qualidade do C√≥digo</th>
        <th style="text-align: center;">Entrega de Tarefas</th>
        <th style="text-align: center;">Resolu√ß√£o de Problemas</th>
        <th style="text-align: center;">M√©dia</th>
        <th style="text-align: center;">Observa√ß√µes</th>
      </tr>
    </thead>
    <tbody>
      {% for form in formset %}
        <tr>
          <td width="400px">
            {{ form.aluno_id }} {{ form.aluno_nome }}
            {{ form.data.as_hidden }}     <!-- precisa ir no POST -->
            {{ form.projeto.as_hidden }}  <!-- precisa ir no POST -->
          </td>
          <td>{{ form.pontualidade }}</td>
          <td>{{ form.comunicacao }}</td>
          <td>{{ form.qualidade_codigo }}</td>
          <td>{{ form.entrega_tarefas }}</td>
          <td>{{ form.resolucao_problemas }}</td>
          <td class="text-right">
                {% if form.media_historico != None %}
                  {{ form.media_historico|floatformat:2 }}
                {% else %}‚Äî{% endif %}
              </td>

          <td>{{ form.observacoes }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <button class="btn primary" type="submit">Salvar Lan√ßamentos</button>
</form>

<script>
  (function(){
    const modal = document.getElementById('criteriaModal');
    const openBtn = document.getElementById('openCriteria');
    const closeBtn = document.getElementById('closeCriteria');

    function openModal() {
      modal.classList.add('show');
      modal.setAttribute('aria-hidden', 'false');
      // foco acess√≠vel
      closeBtn.focus();
      document.addEventListener('keydown', escListener);
    }
    function closeModal() {
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden', 'true');
      openBtn.focus();
      document.removeEventListener('keydown', escListener);
    }
    function escListener(e){ if (e.key === 'Escape') closeModal(); }

    openBtn.addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', function(e){
      if (e.target === modal) closeModal(); // clique fora fecha
    });
  })();
</script>

{% endblock %}
